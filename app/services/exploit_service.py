from typing import Any

from .dbs.databases import get_collection


async def read_exploits_by_cve_id(cve: str) -> list[dict[str, Any]]:
    exploits_collection = get_collection("exploits")
    pipeline: Any = [
        {"$project": {"_id": 0, "id": 1, "cves": 1}},
        {"$match": {"cves": {"$in": [cve]}}},
    ]
    try:
        return [
            exploit["id"] async for exploit in exploits_collection.aggregate(pipeline)
        ]
    except Exception as _:
        return []
